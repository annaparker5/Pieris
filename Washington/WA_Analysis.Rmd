---
title: "WA_Analysis"
output: html_notebook
---

This script will graph and analyze all of the Washington data. 

0. Load in data and packages
1. Manipulate data
2. Graph
  a. Dev rate vs. dev temp - hatch to pupa
  b. Dev rate vs. dev temp - pupa to eclos
  c. Survival vs. dev temp - hatch to pupa (split by block, block 1+2)
  d. Survival vs. dev temp - pupa to eclos (just pupa data)
  e. Survival vs. dev temp - pupa to eclos (block 1+2 data) - lowest priority
  f. Pupal mass vs. dev temp (split by block, block 1+2 data only)
3. Subsequent analyses as needed

# 0. Load in data 

```{r}
library(tidyverse)
library(Rmisc)
```

```{r}
block1 <- read.csv("~/Desktop/GitHub/Pieris/Washington/DataWA/CleanedBlock1.csv", header = TRUE)
block2 <- read.csv("~/Desktop/GitHub/Pieris/Washington/DataWA/CleanedBlock2.csv", header = TRUE)
pupa <- read.csv("~/Desktop/GitHub/Pieris/Washington/DataWA/CleanedPupa.csv", header = TRUE)
```

# 1. Manipulate data

Change temp to factor

```{r}
block1$Treatment <- as.factor(block1$Treatment)
block2$Treatment <- as.factor(block2$Treatment)
pupa$Trt <- as.factor(pupa$Trt)
```

Add block designation to datasets and combine

```{r}
block1$Block <- 1
block2$Block <- 2
```

```{r}
blockcomb <- rbind(block1, block2)
```


# 2. Graph

## a. dev rate vs dev temp (H-P)

Get dev rate (1/dev time)

```{r}
blockcomb$Dev.Rate.P <- 1/(blockcomb$DaysHtoP)
```

Summarize the data 

```{r}
devratepmeans <- summarySE(data = blockcomb[blockcomb$Surv.pupa == "Y", ], measurevar = "Dev.Rate.P", 
                           groupvars = c("Treatment", "PupateOK"))

devratepmeans
```
  
 Graph!   
  
```{r}
devratepgraph <- ggplot(data = devratepmeans, aes(x = Treatment, y = Dev.Rate.P, group = PupateOK, shape = PupateOK)) + 
  theme_bw() + 
  geom_point(size = 3) + 
  geom_errorbar(aes(ymin = Dev.Rate.P - se, ymax = Dev.Rate.P + se), width = 0.3) + 
  scale_shape_manual(values = c(21, 19)) + 
  geom_line(aes(linetype = PupateOK)) + 
  scale_linetype_manual(values = c("dotdash", "solid")) + 
  labs(x = "Temperature Treatment", y = "Development Rate", shape = "Successful Pupation", linetype = "Successful Pupation")

devratepgraph
```

```{r}
ggsave("~/Desktop/GitHub/Pieris/Washington/FigsWA/devrateHtoP.png", devratepgraph, width = 8, height = 5)
```


  
## b. dev rate vs dev temp (p-e)
  
Get dev rate (1/dev time)

```{r}
blockcomb$Dev.Rate.E <- 1/(blockcomb$DaysPtoE)
```

Summarize the data 

```{r}
devrateemeans <- summarySE(data = blockcomb[blockcomb$Surv.eclos == "Y", ], measurevar = "Dev.Rate.E", 
                           groupvars = c("Treatment", "Surv.eclos"))

devrateemeans
```


graph!

```{r}
devrateegraph <- ggplot(data = devrateemeans, aes(x = Treatment, y = Dev.Rate.E, group = Surv.eclos)) + 
  theme_bw() + 
  geom_point(size = 3) + 
  geom_errorbar(aes(ymin = Dev.Rate.E - se, ymax = Dev.Rate.E + se), width = 0.3) + 
  scale_shape_manual(values = c(21)) + 
  geom_line() + 
  scale_linetype_manual(values = c("solid")) + 
  labs(x = "Temperature Treatment", y = "Development Rate")

devrateegraph
```

```{r}
ggsave("~/Desktop/GitHub/Pieris/Washington/FigsWA/devratePtoE.png", devrateegraph, width = 8, height = 5)
```


## 3.  Survival vs dev temp

dev temp on x axis, survival on right axis (amt survived to each respective stage)


## Survival to pupation vs temp treatment 

1. Create summary table
2. Create blank table for input
3. Hard code input
4. Graph it

### 1. Create summary table


```{r}
survpercsum <- summarySE(data = blockcomb, 
                         measurevar = "Mass.pupa", 
                         groupvars = c("Treatment", "Block", "Surv.pupa"))

survpercsum
```




### 2. Create blank table

```{r}
survdata <- data.frame(Treatment = rep(c(16, 21, 26, 30, 34), times = 2), 
                       surv.perc = 0, 
                       Block = rep(c(1, 2), each = 5))

survdata$Treatment <- as.factor(survdata$Treatment)
survdata$Block = as.factor(survdata$Block)
```

### 3. Hard code it

```{r}
survdata[1, 2] <- survpercsum[2, 4] / (survpercsum[2, 4] + survpercsum[1, 4])
survdata[2, 2] <- survpercsum[6, 4] / (survpercsum[6, 4] + survpercsum[5, 4])
survdata[3, 2] <- survpercsum[10, 4] / (survpercsum[10, 4] + survpercsum[9, 4])
survdata[4, 2] <- survpercsum[14, 4] / (survpercsum[14, 4] + survpercsum[13, 4])
survdata[5, 2] <- survpercsum[18, 4] / (survpercsum[18, 4] + survpercsum[17, 4])



survdata[6, 2] <- survpercsum[4, 4] / (survpercsum[4, 4] + survpercsum[3, 4])
survdata[7, 2] <- survpercsum[8, 4] / (survpercsum[8, 4] + survpercsum[7, 4])
survdata[8, 2] <- survpercsum[12, 4] / (survpercsum[12, 4] + survpercsum[11, 4])
survdata[9, 2] <- survpercsum[16, 4] / (survpercsum[16, 4] + survpercsum[15, 4])
survdata[10, 2] <- survpercsum[20, 4] / (survpercsum[20, 4] + survpercsum[19, 4])
```

### 4. Graph it

```{r}
survgraph <- ggplot(data = survdata, aes(x = Treatment, y = surv.perc, group = Block)) + 
  theme_bw() + 
  geom_point(size = 3, aes(shape = Block)) +
  scale_shape_manual(values = c(0, 2)) + 
  geom_line(aes(linetype = Block)) + 
  scale_linetype_manual(values = c("dashed", "dotted")) + 
  ylim(0, 1) + 
  labs(x = "Temperature treatment", y = "Proportion survival to pupation (including LPIs)")

survgraph
```

```{r}
ggsave("~/Desktop/GitHub/Pieris/Washington/FigsWA/survtopupgraph.png", survgraph, width = 8, height = 5)
```

## d. 

### 1. Summarize using summarySE 


### 2. Make new dataframe

```{r}
survdataeclos <- data.frame(Treatment = c(16, 21, 26, 30, 34), 
                            surv.eclos = 0, 
                            group = 1)

survdataeclos$Treatment <- as.factor(survdataeclos$Treatment)

```

### 3. Hard code it

### 4. Graph

## e. 

## f. Pupal mass, block 1+2 -- no LPIs

### 1. Summarize the data 

```{r}
pupalmeans <- summarySE(data = blockcomb[blockcomb$PupateOK == "Y", ], 
                        measurevar = "Mass.pupa", 
                        groupvars = c("Treatment", "Block"))

pupalmeans <- pupalmeans[1:10, ]

pupalmeans$Block <- as.factor(pupalmeans$Block)

pupalmeans
```

### 2. Graph! 

```{r}
pupalmassgraph <- ggplot(data = pupalmeans, aes(x = Treatment, y = Mass.pupa, group = Block, shape = Block)) + 
  theme_bw() + 
  geom_point(size = 3) + 
  geom_errorbar(aes(ymin = Mass.pupa - se, ymax = Mass.pupa + se), width = 0.2) + 
  scale_shape_manual(values = c(0, 2)) + 
  geom_line(aes(linetype = Block)) + 
  scale_linetype_manual(values = c("dashed", "dotted")) + 
  labs(x = "Temperature Treatment", y = "Pupal Mass", shape = "Block", linetype = "Block")

pupalmassgraph
```

```{r}
ggsave("~/Desktop/GitHub/Pieris/Washington/FigsWA/pupalmass.png", pupalmassgraph, width = 8, height = 5)
```


